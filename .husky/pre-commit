echo "ğŸ” Running pre-commit checks..."

# Get staged JavaScript files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|mjs|cjs)$' || true)

if [ -z "$STAGED_FILES" ]; then
  echo "ğŸŸ¡ No JavaScript files staged for commit."
  exit 0
fi

echo "ğŸ“ Files to check:"
echo "$STAGED_FILES"
echo ""

# Run ESLint on staged files
echo "ğŸ” Running ESLint..."
echo "$STAGED_FILES" | xargs npx eslint --max-warnings 0 --no-warn-ignored

# Check if ESLint passed
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ ESLint failed. Please fix the issues before committing."
  echo "ğŸ’¡ Run 'npm run lint:fix' to auto-fix some issues."
  exit 1
fi

echo ""
echo "âœ… ESLint passed on all staged files!"
exit 0